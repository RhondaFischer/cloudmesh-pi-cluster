# Setting up a Pi Kubernetes Cluster

Source: <https://blog.alexellis.io/test-drive-k3s-on-raspberry-pi/>

Use cloudmesh.common.Shell wherever possible. Onet use pipes and >> <<
develop alternative python programs as they may be easier to do than shell scripts
 
 
## Related information

This may be the way to go just that we do the install from the master instead of a laptop?

* <https://github.com/alexellis/k3sup#-micro-tutorial-for-raspberry-pi-2-3-or-4->

We can wrap the join commands in our parallel ssh command to make things faster i hope

* <https://github.com/OmegaSquad82/ansible-k3sup>


## Enable Containers

if "cgroup_enable=cpuset cgroup_memory=1 cgroup_enable=memory" not in /boot/cmdline.txt
   cat  cgroup_enable=cpuset cgroup_memory=1 cgroup_enable=memory >>  /boot/cmdline.txt
   

see cloudmesh.k3.k3.enable_containers():

## NOTE
This current implementation currently requires Wifi settings set up on your worker as you need to download K3S from the internet.

## Setup
### Master
First install Kubernetes (K3S) on the master: 
```
curl -sfL https://get.k3s.io | sh -
```

You can check the status of K3S by using: 
```
sudo systemctl status k3s
```

### Worker (Command Line Implementation)
(Note: 'cms pi' command not implemented yet, currently just command line implementation for each worker)

Steps: 
1. You need to grab the join-token key generated by your master using the command: 
```
sudo cat /var/lib/rancher/k3s/server/node-token
```

2. ssh to your worker node 
```
ssh [WORKER-IP]
```

3. On your worker, run the following command filling in the necessary parameters:
```
curl -sfL http://get.k3s.io | K3S_URL=https://[MASTER IP]:6443  \
K3S_TOKEN=[JOIN-TOKEN FROM STEP 1] sh -
```

