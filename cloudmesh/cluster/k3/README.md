## Install 
**Note**: The install command currently works by setting up Kubernetes on your master and workers, but is having issues adding the worker nodes to the master cluster. Fix coming soon. 
```
pi k3 install --master=MASTER --workers=WORKERS
```
**Note**: If you have never enabled containers on your raspberry pis before, please look at the first option listed below

### Other options for install
Enabling Containers: For Kubernetes to work, you must enable containers. To do this, append the following command to the install command above to enable containers on the master and workers you list. 
```
--step=enable_containers
```

## Other Available Commands
Uninstall Kubernetes on either the master or any worker
```
pi k3 uninstall [--master=MASTER] [--workers=WORKERS]
```

Delete a node(s) from your master's cluster (Not implemented)
```
pi k3 delete --workers=WORKERS
```

Run a test on your setup cluster (Not implemented)
```
pi k3 test --master=MASTER --workers=WORKERS
```

View your cluster:
```
pi k3 view
```


# Everything located below is old implementation for command line
## Setting up a Pi Kubernetes Cluster

Source: <https://blog.alexellis.io/test-drive-k3s-on-raspberry-pi/>

Use cloudmesh.common.Shell wherever possible. Onet use pipes and >> <<
develop alternative python programs as they may be easier to do than shell scripts

## Enable Containers

If ```cgroup_enable=cpuset cgroup_memory=1 cgroup_enable=memory``` is not in /boot/cmdline.txt, please add it to the file using the following command: 
```
cat  cgroup_enable=cpuset cgroup_memory=1 cgroup_enable=memory >>  /boot/cmdline.txt
```

see cloudmesh.k3.k3.enable_containers():

## Setup
### Master
First install Kubernetes (K3S) on the master: 
```
curl -sfL https://get.k3s.io | sh -
```

You can check the status of K3S by using: 
```
sudo systemctl status k3s
```

### Worker (Command Line Implementation)

Steps: 
1. You must first set up your workers to connect to the internet through your master. This is done by using the command ```cms bridge```. You can find the documentation here to set it up: https://github.com/cloudmesh/cloudmesh-pi-cluster/tree/master/cloudmesh/bridge

2. You need to grab the join-token key generated by your master using the command: 
```
sudo cat /var/lib/rancher/k3s/server/node-token
```

3. ssh to your worker node 
```
ssh [WORKER-IP]
```

4. On your worker, run the following command filling in the necessary parameters:
```
curl -sfL http://get.k3s.io | K3S_URL=[NAME OF MASTER]:6443  \
K3S_TOKEN=[JOIN-TOKEN FROM STEP 1] sh -
```
CURRENT BUG: When running the above command, it will set a password for your Raspberry Pi (which does not display in the command output either) 

### View Cluster
You can view your cluster setup with master and work status with the command:
```
sudo kubectl get node

NAME       STATUS   ROLES    AGE    VERSION
purple     Ready    master   2d1h   v1.17.4+k3s1
purple01   Ready    <none>   22m    v1.17.4+k3s1

```
